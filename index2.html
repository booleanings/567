<!DOCTYPE html>
<meta charset="utf-8">

<body>
    <script src="//d3js.org/d3.v5.min.js"></script>
    <script>
        var width = 960,
            height = 500,
            padding = 1.5, // separation between same-color nodes
            clusterPadding = 6, // separation between different-color nodes
            maxRadius = 12;

        var n = 151, // total number of nodes
            m = 151; // number of distinct clusters

        // The largest node for each cluster.
        var clusters = new Array(m);

        var means = {};
        var nodes = [];
        
        // Start function
        const start = async function (a, b) {
            var i = 0;
            const data = await d3.json("data-mod.json");
            data.forEach(function (d) {
                d.Category = d.Category;
                d.tenth = +d.tenth;
                // nodes.push(d);
                if (!+d.tenth) {
                    currCat = d.Category;
                }
                if (d.Category == "Mean" && +d.tenth) {
                    means[currCat] = +d.tenth;
                    // console.log("currcat: " + currCat + " d.tenth: " + +d.tenth);
                    nodes.push({
                        cluster: currCat,
                        i: i,
                        r: +d.tenth/1886.140,
                        x: Math.cos(i / m * 2 * Math.PI) * 200 + width / 2 + Math.random(),
                        y: Math.sin(i / m * 2 * Math.PI) * 200 + height / 2 + Math.random()
                    })
                }
                i++;
                return d;
            }
            );
           var simulation = d3.forceSimulation()
          .nodes(data);

      simulation
          .force("charge_force", d3.forceManyBody())
          .force("center_force", d3.forceCenter(width / 2, height / 2));

var svg = d3.select("body").append("svg")
    .attr("width", width)
    .attr("height", height);

var i = 0;
 var node = svg.selectAll('circle')
        .data(nodes)
        .enter()
        .append('circle')
        .attr("cx",function(d) { 
        return d.x})
        .attr("cy",function(d) { 
        return d.y})
        .attr("r", function(d) { 
            console.log(d);
        return d.r})
        .attr("fill", "green")
        .attr("stroke-width", .1)
        .attr("stroke", "black")
        .attr("opacity", .8)
        ;

        function tickActions() {
          //update circle positions each tick of the simulation 
          node
              .attr("cx", function(d) { return projection([d.Longitude,d.Latitude])[0]; }).merge(g)
              .attr("cy", function(d) { return projection([d.Longitude,d.Latitude])[1]; }).merge(g);
        }
        }
        start();

        // console.log("AFTER: " + nodes.length)

    </script>